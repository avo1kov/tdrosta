<!-- 7ecc37e5-b780-4122-968a-5302a9a52112 6487f485-4596-4566-a171-f05efc03ee0b -->
# Технический аудит и оптимизация сайта tdrosta.ru

## Критические проблемы производительности

### 1. Производительность (Mobile: 33/100, Desktop: 57/100)

**Проблемы:**

- Render-blocking ресурсы: CSS файлы загружаются синхронно в `<head>`
- jQuery загружается из внешнего CDN без defer/async
- Yandex Metrika скрипт блокирует рендеринг
- Большие изображения без оптимизации (514.5 KiB, 63.4 KiB и др.)
- Неоптимизированные шрифты (множество .woff файлов)
- Отсутствие кэширования и сжатия

**Решения:**

- Добавить defer/async для всех скриптов в footer
- Перенести Yandex Metrika в footer с async
- Включить lazy loading для всех изображений
- Оптимизировать изображения (WebP, сжатие)
- Добавить font-display: swap для шрифтов
- Настроить кэширование через .htaccess
- Минифицировать CSS/JS файлы

### 2. SEO проблемы

**Проблемы:**

- Отсутствует robots.txt в корне
- Устаревший XHTML DOCTYPE
- Нет meta description в header.php
- Hardcoded HTTP URLs в JavaScript (common.js строка 14, 20)
- Отсутствует structured data (Schema.org)
- Ссылка на sitemap.xml с опечаткой (footer.php строка 41: `/sitemap.xml.`)
- Смешанное использование HTTP/HTTPS

**Решения:**

- Создать robots.txt с правилами для поисковых систем
- Обновить DOCTYPE на HTML5
- Добавить динамические meta description через Yoast SEO или вручную
- Заменить все HTTP на HTTPS в коде
- Добавить JSON-LD structured data для организации
- Исправить ссылку на sitemap.xml
- Настроить canonical URLs

### 3. Код и архитектура

**Проблемы:**

- Устаревший jQuery 3.4.1 (текущая версия 3.7.1)
- Inline скрипты в header (Yandex Metrika)
- Множественные CSS файлы загружаются отдельно
- Отсутствие объединения (concatenation) ресурсов
- Нет версионирования для статических ресурсов (кроме ?v=2)

**Решения:**

- Обновить jQuery до последней версии или использовать нативный JS
- Вынести inline скрипты в отдельные файлы
- Объединить CSS файлы или использовать критический CSS
- Настроить правильное версионирование ресурсов
- Добавить preload для критических ресурсов

### 4. Безопасность

**Проблемы:**

- Версия WordPress видна в meta generator
- Отсутствуют security headers
- Нет защиты от XSS в некоторых местах

**Решения:**

- Удалить или скрыть версию WordPress
- Добавить security headers в .htaccess
- Включить HTTPS редирект

### 5. Конфигурация сервера

**Проблемы:**

- .htaccess практически пустой (только WordPress директивы)
- Нет настроек кэширования
- Нет gzip/brotli сжатия
- Нет expires headers

**Решения:**

- Добавить правила кэширования в .htaccess
- Включить gzip сжатие
- Настроить expires headers для статических ресурсов
- Добавить preconnect для внешних доменов

## План реализации

### Фаза 1: Критические исправления (высокий приоритет)

1. Исправить hardcoded HTTP URLs на HTTPS
2. Создать robots.txt
3. Добавить meta description
4. Исправить ссылку на sitemap.xml
5. Обновить DOCTYPE на HTML5

### Фаза 2: Оптимизация производительности (высокий приоритет)

1. Добавить defer/async для скриптов
2. Оптимизировать загрузку CSS (критический CSS)
3. Настроить кэширование в .htaccess
4. Включить gzip сжатие
5. Оптимизировать изображения

### Фаза 3: SEO улучшения (средний приоритет)

1. Добавить structured data
2. Настроить canonical URLs
3. Улучшить внутреннюю перелинковку
4. Проверить и исправить все внутренние ссылки

### Фаза 4: Безопасность и финальная оптимизация (средний приоритет)

1. Добавить security headers
2. Скрыть версию WordPress
3. Финальная оптимизация кода
4. Тестирование всех изменений

## Ожидаемые результаты

- Улучшение PageSpeed Score: Mobile 33 → 70+, Desktop 57 → 85+
- Улучшение Core Web Vitals (LCP, FID, CLS)
- Улучшение позиций в Яндексе (индексация, ранжирование)
- Правильная работа с Яндекс.Вебмастер
- Повышение безопасности сайта
- Улучшение пользовательского опыта
- Корректная работа микроразметки для Яндекса

### To-dos

- [ ] Заменить все hardcoded HTTP URLs на HTTPS в common.js и других файлах
- [ ] Создать robots.txt в корне проекта с правилами для поисковых систем
- [ ] Обновить DOCTYPE с XHTML на HTML5 в header.php
- [ ] Добавить динамические meta description в header.php
- [ ] Исправить ссылку на sitemap.xml в footer.php (убрать точку)
- [ ] Добавить defer/async атрибуты для всех скриптов в footer.php
- [ ] Перенести Yandex Metrika скрипт в footer с async атрибутом
- [ ] Оптимизировать загрузку CSS (добавить preload для критического CSS, defer для остального)
- [ ] Настроить кэширование, gzip и expires headers в .htaccess
- [ ] Добавить инструкции по оптимизации изображений (WebP конвертация, сжатие)
- [ ] Добавить JSON-LD structured data для организации в header.php
- [ ] Добавить security headers в .htaccess
- [ ] Скрыть версию WordPress из meta generator
- [ ] Обновить jQuery до последней версии или рассмотреть замену на нативный JS